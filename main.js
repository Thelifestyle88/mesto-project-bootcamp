(()=>{"use strict";var e="popup__form-input_error",t="-error_active",r="popup__form-submit_inactive",n="-error";function o(r,o){var c=r.querySelector(".".concat(o.id).concat(n));o.classList.remove(e),c.classList.remove("".concat(o.id).concat(t)),c.textContent=""}function c(r,c){c.validity.valid?o(r,c):function(r,o,c){var u=r.querySelector(".".concat(o.id).concat(n));o.classList.add(e),u.textContent=c,u.classList.add("".concat(o.id).concat(t))}(r,c,c.validationMessage)}function u(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r),t.removeAttribute("disabled",!0)):(t.classList.add(r),t.setAttribute("disabled",!0))}function a(e){var t=Array.from(e.querySelectorAll(".popup__form-input")),r=e.querySelector(".popup__form-submit");t.forEach((function(t){c(e,t),o(e,t)})),u(t,r)}var i={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-3/",header:{authorization:"9035a3ae-3144-4c5d-a2fb-c77d4c0cdff6"},headers:{authorization:"9035a3ae-3144-4c5d-a2fb-c77d4c0cdff6","Content-Type":"application/json"}};function l(e){return e.ok?e.json():e.json().then((function(t){return t.statusCode=e.status,Promise.reject(t)}))}var s=document.querySelector(".elements");function d(e){s.prepend(e)}var p=document.querySelector("#element").content;function f(e){var t,r,n=e.target;t=n.src,r=n.alt,q.src=t,q.alt=r,g.textContent=r,H(k)}function m(e){var t,r,n=e.target.closest(".element"),o=n.querySelector(".element__likes-count");(t=n.id,r=n._likes.includes(n._userId),fetch("".concat(i.baseUrl,"/cards/likes/").concat(t),{method:r?"DELETE":"PUT",headers:i.header}).then(l)).then((function(t){n._likes=t.likes.map((function(e){return e._id})),o.textContent=n._likes.length,n._likes.includes(n._userId)?e.target.classList.add("element__like_black"):e.target.classList.remove("element__like_black")})).catch(console.error)}function _(e){var t=e.target.closest(".element");sessionStorage.setItem("itemToDelete",t.id),sessionStorage.getItem("itemToDelete")&&H(P)}function v(e,t){var r=p.querySelector(".element").cloneNode(!0),n=r.querySelector(".element__foto");r.querySelector(".element__title").textContent=e.name,r.querySelector(".element__likes-count").textContent=e.likes.length,n.src=e.link,n.alt=e.name;var o=r.querySelector(".element__like");r.id=e._id,r._userId=t,r._likes=e.likes.map((function(e){return e._id})),r._ownerId=e.owner._id;var c=r.querySelector(".element__trash");return e.owner._id!==r._userId&&c.classList.add("element__trash_inactive"),e.likes.forEach((function(e){e._id===r._userId&&o.classList.add("element__like_black")})),c.addEventListener("click",_),o.addEventListener("click",m),n.addEventListener("click",f),r}var y=document.querySelector(".profile__title"),h=document.querySelector(".profile__subtitle"),S=document.querySelector(".profile__image");function b(e){y.textContent=e.name,h.textContent=e.about,S.src=e.avatar}var q=document.querySelector(".popup__foto"),g=document.querySelector(".popup__description"),k=document.querySelector(".popup_image"),E=document.querySelector(".popup__form-input_place-title"),L=document.querySelector(".popup__form-input_place-subtitle"),A=document.querySelector(".popup__form-input_edit-title"),C=document.querySelector(".popup__form-input_edit_subtitle"),I=document.querySelector(".popup__form_create"),T=document.querySelector(".popup__form_edit"),x=document.querySelector(".popup_new-place"),D=document.querySelectorAll(".popup__button-close"),U=document.querySelector(".popup__avatar_form"),j=document.querySelector(".popup_profile_edit"),w=document.querySelector(".popup__form-input_edit_avatar"),O=document.querySelector(".popup_avatar_edit"),P=document.querySelector(".popup_delete"),N=document.querySelector(".popup__form_delete"),J=document.querySelector(".popup__form-submit-save"),z=document.querySelector(".popup__form-submit-avatar"),G=document.querySelector(".popup__form-submit-create");function H(e){e.classList.add("popup_opened"),document.addEventListener("keyup",K)}function M(e){e.classList.remove("popup_opened"),document.removeEventListener("keyup",K)}function B(e){e.target===e.currentTarget&&M(e.target)}function $(e){M(e.target.closest(".popup"))}function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сохранить";e.textContent=t}function K(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&M(t)}}function Q(){E.value="",L.value=""}function R(){w.value=""}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var W=document.querySelector(".profile__edit-button"),X=document.querySelector(".profile__add-button"),Y=document.querySelector(".profile__avatar");Promise.all([fetch("".concat(i.baseUrl,"users/me"),{method:"GET",headers:i.header}).then(l),fetch("".concat(i.baseUrl,"cards"),{method:"GET",headers:i.header}).then(l)]).then((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c,u,a=[],i=!0,l=!1;try{if(c=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=c.call(r)).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(t,r)||function(e,t){if(e){if("string"==typeof e)return V(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?V(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],c=n[1];b(o),sessionStorage.setItem("userId",o._id),c.forEach((function(e){return d(v(e,o._id))}))})).catch(console.error),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){var t,r,n;t=e,r=Array.from(t.querySelectorAll(".popup__form-input")),n=t.querySelector(".popup__form-submit"),u(r,n),r.forEach((function(e){e.addEventListener("input",(function(){c(t,e),u(r,n)}))}))})),I.addEventListener("submit",(function(e){var t;e.preventDefault(),F(G,"Cохранение..."),function(e){return fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify(e)}).then(l)}((t={},t.name=E.value,t.link=L.value,t)).then((function(e){!function(e){d(v(e,sessionStorage.getItem("userId")))}(e),M(x),Q()})).catch(console.error).finally((function(){return F(G)}))})),T.addEventListener("submit",(function(e){var t;e.preventDefault(),F(J,"Cохранение..."),function(e){return fetch("".concat(i.baseUrl,"users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify(e)}).then(l)}((t={},t.name=A.value,t.about=C.value,t)).then((function(e){b(e),M(j)})).catch(console.error).finally((function(){return J.textContent="Сохранить"}))})),U.addEventListener("submit",(function(e){var t;e.preventDefault(),F(z,"Cохранение..."),(t=w.value,fetch("".concat(i.baseUrl,"users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:"".concat(t)})}).then(l)).then((function(e){b(e),R(),M(O)})).catch(console.error).finally((function(){return F(z)}))})),N.addEventListener("submit",(function(e){e.preventDefault();var t,r=sessionStorage.getItem("itemToDelete"),n=document.getElementById(r);(t=r,fetch("".concat(i.baseUrl,"cards/").concat(t),{method:"DELETE",headers:i.header}).then(l)).then((function(){n.remove(),M(P),sessionStorage.removeItem("itemToDelete")})).catch(console.error)})),Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("click",B)})),Array.from(D).forEach((function(e){e.addEventListener("click",$)})),W.addEventListener("click",(function(){var e;e={name:y.textContent,about:h.textContent},A.value=e.name,C.value=e.about,a(T),H(j)})),X.addEventListener("click",(function(){Q(),a(I),H(x)})),Y.addEventListener("click",(function(){R(),a(U),H(O)}))})();
//# sourceMappingURL=main.js.map